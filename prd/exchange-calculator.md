# 환율 계산기 PRD (Product Requirements Document)

## 문서 정보
- **작성일**: 2026-01-20
- **버전**: 1.0
- **상태**: 개발 중

---

## 1. 개요

### 1.1 프로젝트 목적
중국(CNY) 또는 미국(USD)에서 제품을 수입할 때 원화(KRW) 기준 금액을 환산하는 웹 애플리케이션

### 1.2 1차 목표 (MVP)
1. **실시간 환율 조회** - 한국수출입은행 API 연동
2. **외화 → 원화 환산** - USD/KRW, CNY/KRW 지원

### 1.3 향후 확장 예정
- 배송비 계산
- 관세 계산
- 부가세 계산
- 총 수입원가 자동 계산

---

## 2. 기능 명세

### 2.1 환율 조회 기능
| 항목 | 설명 |
|------|------|
| 데이터 소스 | 한국수출입은행 Open API |
| 지원 통화 | USD (미국 달러), CNY (중국 위안) |
| 환율 유형 | 매매기준율 (deal_bas_r) |
| 업데이트 주기 | 사용자 요청 시 (새로고침 버튼) |

### 2.2 금액 환산 기능
| 항목 | 설명 |
|------|------|
| 입력 | 외화 금액 (USD 또는 CNY) |
| 출력 | 원화 금액 (KRW) |
| 계산 방식 | 외화 금액 × 환율 = 원화 금액 |
| 실시간 계산 | 금액 입력 시 즉시 환산 결과 표시 |

---

## 3. API 연동 명세

### 3.1 한국수출입은행 환율 API

**Endpoint**
```
https://oapi.koreaexim.go.kr/site/program/financial/exchangeJSON
```

**요청 파라미터**
| 파라미터 | 필수 | 설명 | 예시 |
|---------|------|------|------|
| authkey | O | 인증키 | 발급받은 API 키 |
| searchdate | X | 조회 날짜 (YYYYMMDD) | 20260120 |
| data | O | 데이터 타입 | AP01 (환율) |

**응답 필드**
| 필드명 | 설명 | 예시 |
|--------|------|------|
| cur_unit | 통화 코드 | USD, CNY |
| cur_nm | 통화명 | 미국 달러, 중국 위안 |
| deal_bas_r | 매매기준율 | "1,473.50" |
| ttb | 전신환 매입률 | "1,459.03" |
| tts | 전신환 매도율 | "1,487.97" |

**주의사항**
- 일일 호출 제한: 1,000회
- 환율은 쉼표가 포함된 문자열로 반환 → 숫자로 파싱 필요
- 주말/공휴일에는 데이터가 없을 수 있음

### 3.2 API 키 발급 방법

1. [한국수출입은행 Open API 페이지](https://www.koreaexim.go.kr/ir/HPHKIR020M01) 접속
2. "Open API 인증키 발급" 탭 클릭
3. 본인 인증 (휴대폰 또는 이메일)
4. 인증키 발급 완료
5. "나의 인증키 발급내역"에서 키 확인

**비용**: 무료

---

## 4. 기술 설계

### 4.1 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                        브라우저 (클라이언트)                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              ExchangeCalculator.tsx                  │   │
│  │  - 환율 표시                                         │   │
│  │  - 통화 선택 (USD/CNY)                               │   │
│  │  - 금액 입력                                         │   │
│  │  - 환산 결과 표시                                     │   │
│  └──────────────────────┬──────────────────────────────┘   │
│                         │                                   │
│                         │ useExchangeRate() 훅 사용         │
│                         ▼                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              useExchangeRate.ts                      │   │
│  │  - API 호출 (/api/exchange-rate)                     │   │
│  │  - 로딩/에러 상태 관리                                │   │
│  └──────────────────────┬──────────────────────────────┘   │
└─────────────────────────┼───────────────────────────────────┘
                          │
                          │ HTTP GET 요청
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                      서버 (Next.js API Route)                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │           /api/exchange-rate/route.ts                │   │
│  │  - API 키 보호 (환경변수)                             │   │
│  │  - 한국수출입은행 API 호출                            │   │
│  │  - USD, CNY 필터링                                   │   │
│  │  - 응답 데이터 가공                                   │   │
│  └──────────────────────┬──────────────────────────────┘   │
└─────────────────────────┼───────────────────────────────────┘
                          │
                          │ HTTPS 요청
                          ▼
┌─────────────────────────────────────────────────────────────┐
│                  한국수출입은행 Open API                      │
│            oapi.koreaexim.go.kr                             │
└─────────────────────────────────────────────────────────────┘
```

### 4.2 폴더 구조

```
src/
├── app/
│   ├── api/
│   │   └── exchange-rate/
│   │       └── route.ts          # 환율 API Route (서버)
│   └── page.tsx                   # 메인 페이지
├── components/
│   └── ExchangeCalculator.tsx     # 환율 계산기 컴포넌트
├── hooks/
│   └── useExchangeRate.ts        # 환율 조회 커스텀 훅
└── types/
    └── exchange.ts               # 타입 정의
```

### 4.3 데이터 타입

```typescript
// 지원 통화 코드
type CurrencyCode = "USD" | "CNY"

// 환율 정보
interface ExchangeRate {
  currencyCode: CurrencyCode
  currencyName: string
  baseRate: number        // 매매기준율
  updatedAt: string       // 업데이트 날짜
}

// API 응답
interface ExchangeRateResponse {
  success: boolean
  data?: {
    USD: ExchangeRate
    CNY: ExchangeRate
  }
  error?: {
    code: string
    message: string
  }
}
```

---

## 5. UI 설계

### 5.1 화면 레이아웃

```
┌─────────────────────────────────────────────┐
│             환율 계산기                      │
├─────────────────────────────────────────────┤
│                                             │
│  현재 환율 (2026-01-20 기준)      [새로고침] │
│  ┌─────────────┬─────────────┐             │
│  │ USD         │ CNY         │             │
│  │ 1,473.56원  │   201.23원  │             │
│  └─────────────┴─────────────┘             │
│                                             │
├─────────────────────────────────────────────┤
│                                             │
│  금액 입력                                   │
│  ┌──────────┐  ┌──────────────────┐        │
│  │ USD  ▼  │  │     100          │        │
│  └──────────┘  └──────────────────┘        │
│                                             │
├─────────────────────────────────────────────┤
│                                             │
│  환산 결과                                   │
│                                             │
│     100 USD = 147,356 원                   │
│                                             │
└─────────────────────────────────────────────┘
```

### 5.2 UI 컴포넌트

| 컴포넌트 | 사용처 | shadcn/ui |
|---------|--------|-----------|
| Card | 전체 레이아웃 | card.tsx |
| Select | 통화 선택 | select.tsx |
| Input | 금액 입력 | input.tsx |
| Button | 새로고침 | button.tsx |
| Skeleton | 로딩 상태 | skeleton.tsx |

### 5.3 상태 관리

| 상태 | 설명 | 초기값 |
|------|------|--------|
| currency | 선택된 통화 | "USD" |
| amount | 입력된 금액 | 0 |
| rates | 환율 데이터 | null |
| isLoading | 로딩 상태 | true |
| error | 에러 메시지 | null |

---

## 6. 에러 처리

### 6.1 에러 유형 및 대응

| 에러 유형 | 원인 | 사용자 메시지 |
|----------|------|---------------|
| API 키 누락 | 환경변수 미설정 | "서비스 설정 오류입니다" |
| API 호출 실패 | 네트워크 오류 | "환율 정보를 불러올 수 없습니다" |
| 데이터 없음 | 주말/공휴일 | "영업일 환율 정보가 없습니다" |

### 6.2 에러 복구

- 모든 에러 상황에서 "새로고침" 버튼 제공
- API 호출 실패 시 3회 자동 재시도

---

## 7. 테스트 계획

### 7.1 API Route 테스트
- [ ] 브라우저에서 `/api/exchange-rate` 접속
- [ ] USD, CNY 환율 데이터 JSON 반환 확인
- [ ] API 키 없을 때 에러 응답 확인

### 7.2 UI 테스트
- [ ] 환율 정상 표시 확인
- [ ] 통화 선택 (USD ↔ CNY) 동작 확인
- [ ] 금액 입력 시 실시간 환산 확인
- [ ] 새로고침 버튼 동작 확인

### 7.3 에러 처리 테스트
- [ ] 네트워크 오류 시 에러 메시지 표시
- [ ] 로딩 상태 UI 표시

---

## 8. 환경 설정

### 8.1 환경변수

**.env.local**
```env
# 한국수출입은행 환율 API 인증키
KOREAEXIM_API_KEY=발급받은_API_키
```

### 8.2 주의사항
- `.env.local` 파일은 Git에 커밋하지 않음 (이미 `.gitignore`에 포함)
- API 키는 서버 사이드에서만 사용 (NEXT_PUBLIC_ 접두사 사용 금지)

---

## 9. 참고 자료

### 9.1 공식 문서
- [한국수출입은행 Open API](https://www.koreaexim.go.kr/ir/HPHKIR020M01)
- [공공데이터포털 - 환율정보](https://www.data.go.kr/data/3068846/openapi.do)
- [Next.js Route Handlers](https://nextjs.org/docs/app/building-your-application/routing/route-handlers)

### 9.2 기존 프로젝트 참고 파일
- `src/lib/format.ts` - 숫자 포맷팅 (천 단위 콤마)
- `src/hooks/useDebounce.ts` - 커스텀 훅 작성 패턴
- `src/components/ui/` - shadcn/ui 컴포넌트
