# 수입원가 계산기 확장 PRD

## 문서 정보
- **작성일**: 2026-01-21
- **버전**: 1.1
- **상태**: 기획 중
- **관련 PRD**: unified-calculator.md

---

## 1. 개요

### 1.1 프로젝트 목적
기존 "통합 수입원가 계산기"에 물류비용(CBM, 운송료, 부대비용 등)을 추가하여 실제 수입원가를 정확히 계산

### 1.2 해결하려는 문제
- **기존**: 제품가격 + 관세 + 부가세만 계산
- **문제**: 실제 수입에는 국제운송료, 국내운송료, 통관비용 등 추가 비용 발생
- **개선**: 모든 비용을 포함한 실제 수입원가 계산

### 1.3 핵심 변경사항
1. UI 레이아웃: 좌측 입력 / 우측 결과 (스크롤 없이 한 페이지)
2. CBM 자동 계산 (제품 크기 x 수량)
3. 부대 비용 (임의 금액 직접 입력 가능)
4. 국제 운송 회사별 비용 관리 (CBM 구간 + 공통 비용)
5. 공통 비용 (송금 수수료, 국내 운송료)
6. Convex 데이터베이스 연동

---

## 2. 입력 변수

### 2.1 제품 정보

| 변수명 | 설명 | 입력 방식 | 비고 |
|--------|------|----------|------|
| 제품명/카테고리 | HS Code 연동 | 검색 + 자동완성 | *데이터 추후 제공 예정* |
| 제품 원가 | 제품 1개 가격 (외화) | 숫자 입력 | USD 또는 CNY |
| 제품 수량 | 수입 수량 (개) | 숫자 입력 | - |
| 제품 단일 크기 | 가로 x 높이 x 폭 (cm) | 숫자 3개 입력 | CBM 자동 계산에 사용 |

### 2.2 자동 연동 데이터

| 데이터 | 출처 | 설명 |
|--------|------|------|
| 환율 | 한국수출입은행 API | 실시간 매매기준율 |
| 관세율 | HS Code 데이터 | 기본세율 / FTA 세율 (*추후 제공*) |

---

## 3. 비용 구조

### 3.1 부대 비용

> **특징**: 업체마다 다르므로 추가/삭제/수정 기능 필요, **임의로 금액을 직접 입력 가능**

| 항목 | 설명 | 기본값 | 비고 |
|------|------|--------|------|
| 중국 내륙 운송료 | 중국 배송지 거리/부피에 따라 책정 | - | *로직 추후 제공 예정* |
| 기타 부대 비용 | 사용자가 직접 추가 가능 | 0원 | 임의 금액 입력 |

**기능 요구사항**:
- [ ] 부대 비용 항목 추가/삭제/수정 (CRUD)
- [ ] 각 항목별 금액 직접 입력 가능
- [ ] 업체별로 다른 부대 비용 템플릿 관리

---

### 3.2 국제 운송 회사 분류

> **특징**: 업체마다 CBM 구간 및 공통 비용이 다르므로 업체별 관리 필요

#### 3.2.1 CBM 구간별 국제 운송료

업체별로 CBM 구간에 따른 운송료를 다르게 설정

| 구간 | 예시 단가 | 비고 |
|------|----------|------|
| 0 ~ 0.5 CBM | 50,000원 (고정) | 업체별 설정 |
| 0.5 ~ 1 CBM | 100,000원/CBM | 업체별 설정 |
| 1 ~ 2 CBM | 90,000원/CBM | 업체별 설정 |
| 2 ~ 5 CBM | 80,000원/CBM | 업체별 설정 |
| 5 CBM 이상 | 70,000원/CBM | 업체별 설정 |

**기능 요구사항**:
- [ ] 국제 운송 업체 추가/삭제/수정 (CRUD)
- [ ] 업체별 CBM 구간 추가/삭제/수정 (CRUD)

#### 3.2.2 업체별 공통 비용 (통관 건당 발생)

> **중요**: CBM을 제외한 나머지 항목은 **통관 건마다 발생**하므로, 주문 건수에 따라 금액을 나눌 수 있어야 함

| 항목 | 기본 금액 | 주문 건수 분할 | 예시 |
|------|----------|---------------|------|
| 통관 수수료 | 22,000원 | O | 2건 수입 시 → 11,000원/건 |
| D/O 비용 | 35,000원 | O | 2건 수입 시 → 17,500원/건 |
| C/O 비용 | 25,000원 | O | 2건 수입 시 → 12,500원/건 |
| 기타 | 사용자 추가 | O | 업체별 설정 가능 |

**주문 건수 분할 예시**:
```
통관 수수료 = 22,000원 (고정)
주문 건수 = 2건
실질적인 원가 = 22,000 / 2 = 11,000원
```

**기능 요구사항**:
- [ ] 업체별 공통 비용 항목 추가/삭제/수정 (CRUD)
- [ ] 주문 건수 입력 시 자동으로 금액 분할 계산
- [ ] 분할 적용 여부 항목별 설정 가능

---

### 3.3 공통 비용 (모든 수입에 적용)

#### 3.3.1 송금 수수료
```
if (원화금액 >= 1,000,000원) {
  송금수수료 = 27,000원 (고정)
} else {
  송금수수료 = 원화금액 x 3%
}
```

#### 3.3.2 국내 운송료 (CBM 기준 자동 계산)
```
기본료: 50,000원 (0.5CBM까지 포함)
추가료: 0.1CBM당 10,000원 추가

공식:
if (CBM <= 0.5) {
  국내운송료 = 50,000원
} else {
  추가단위 = Math.ceil((CBM - 0.5) / 0.1)
  국내운송료 = 50,000 + (추가단위 x 10,000)
}
```

**예시**: 0.9 CBM인 경우
- 기본료: 50,000원
- 추가 CBM: 0.9 - 0.5 = 0.4 CBM
- 추가 단위: 0.4 / 0.1 = 4 단위
- 추가료: 4 x 10,000 = 40,000원
- **총 국내운송료: 90,000원**

---

## 4. 계산 로직

### 4.1 CBM 계산 (공식 CBM 계산 공식)
```
단일 CBM = (가로cm x 높이cm x 폭cm) / 1,000,000
총 CBM = 단일 CBM x 수량
```

**예시**: 30cm x 20cm x 15cm, 100개
- 단일 CBM = (30 x 20 x 15) / 1,000,000 = 0.009 m³
- 총 CBM = 0.009 x 100 = 0.9 m³

### 4.2 총 수입원가 계산
```
[계산 단계]
1. 원화 환산
   제품가격(원화) = 제품원가 x 수량 x 환율

2. 관세/부가세
   관세 = 제품가격(원화) x 관세율
   과세가격 = 제품가격(원화) + 관세
   부가세 = 과세가격 x 10%

3. 운송료
   국제운송료 = CBM 구간별 단가 적용 (업체별)
   국내운송료 = CBM 기준 자동 계산

4. 부대 비용
   부대비용합계 = 중국내륙운송료 + 기타부대비용

5. 업체별 공통 비용 (주문 건수 분할)
   업체공통비용 = (통관수수료 + D/O비용 + C/O비용 + 기타) / 주문건수

6. 공통 비용
   송금수수료 = 100만원 이상 시 27,000원, 미만 시 3%
   국내운송료 = CBM 기준 자동 계산

7. 총 수입원가
   totalCost = 제품가격(원화) + 관세 + 부가세
             + 국제운송료 + 국내운송료
             + 부대비용합계 + 업체공통비용
             + 송금수수료

8. 개당 수입원가
   unitCost = totalCost / 수량
```

### 4.3 계산 예시

**입력값**
| 항목 | 값 |
|------|-----|
| 품목 | 편물제 장갑 (6116100000) |
| 원가 | 100 CNY/개 |
| 수량 | 1,000개 |
| 크기 | 30 x 20 x 15 cm |
| 환율 | 190원/CNY |
| 관세율 (FTA) | 0% |
| 주문건수 | 2건 |

**계산 결과**
| 항목 | 계산 | 금액 |
|------|------|------|
| 총 CBM | 0.009 x 1,000 | 9 CBM |
| 제품가격 | 100 x 1,000 x 190 | 19,000,000원 |
| 관세 | 19,000,000 x 0% | 0원 |
| 부가세 | 19,000,000 x 10% | 1,900,000원 |
| 국제운송료 | 9 x 70,000 | 630,000원 |
| 국내운송료 | 50,000 + 850,000 | 900,000원 |
| 부대비용 | 직접입력 | 100,000원 (예시) |
| 송금수수료 | 고정 | 27,000원 |
| 통관수수료 | 22,000 / 2 | 11,000원 |
| D/O비용 | 35,000 / 2 | 17,500원 |
| **총 수입원가** | - | **22,585,500원** |
| **개당 원가** | 22,585,500 / 1,000 | **22,586원** |

---

## 5. UI 설계

### 5.1 전체 레이아웃 (좌우 분할, 스크롤 없음)

```
+------------------------------------------------------------------+
|  [HEADER] 중국 수입원가 계산기                                     |
|  실시간 환율과 물류비용을 포함한 정확한 수입원가 계산                  |
+-------------------------------+----------------------------------+
|       좌측: 입력 영역          |        우측: 결과 영역            |
+-------------------------------+----------------------------------+
| [환율 정보]                    | [CBM 계산 결과]                  |
| USD: 1,350원 | CNY: 190원     | 단일 CBM: 0.009 m³               |
| [USD 선택] [CNY 선택]          | 총 CBM: 9.0 m³                  |
|                               |                                  |
| [품목 검색]                    +----------------------------------+
| [검색 아이콘] HS Code/제품명   | [비용 상세 내역]                  |
| *데이터 추후 제공 예정          |                                  |
|                               | 제품가격        19,000,000원     |
| [제품 정보]                    | ──────────────────────           |
| 원가: [    100    ] CNY       | 관세 (0%)              0원       |
| 수량: [   1,000   ] 개        | 부가세 (10%)     1,900,000원     |
|                               | ──────────────────────           |
| [제품 크기] (cm)               | 국제운송료         630,000원     |
| 가로: [30] 높이: [20] 폭: [15] | 국내운송료         900,000원     |
|                               | ──────────────────────           |
| [국제 운송 회사]               | 부대비용           100,000원     |
| [업체 선택 드롭다운] [설정]     | 송금수수료          27,000원     |
|                               | ──────────────────────           |
| [부대 비용]                    | 통관수수료 (÷2)     11,000원     |
| 중국내륙: [      ] 원 (직접입력)| D/O비용 (÷2)       17,500원     |
| [+ 항목 추가]                  |                                  |
|                               +----------------------------------+
| [업체별 공통 비용]              | [총 수입원가]                    |
| ☑ 통관수수료 22,000원          |                                  |
| ☑ D/O비용   35,000원          | ╔══════════════════════════╗     |
| ☐ C/O비용   25,000원          | ║  22,585,500원            ║     |
| [+ 항목 추가]                  | ║  (개당 22,586원)          ║     |
|                               | ╚══════════════════════════╝     |
| [주문 건수]                    |                                  |
| 이 통관 건의 주문 수: [2]       +----------------------------------+
|                               | [기본세율 vs FTA 비교]           |
|                               | 기본: 24,000,000원               |
|                               | FTA:  22,585,500원               |
|                               | 절감: 1,414,500원                |
+-------------------------------+----------------------------------+
```

### 5.2 컴포넌트 구조

| 영역 | 컴포넌트 | 설명 |
|------|----------|------|
| 좌측 상단 | CurrencySelector | 환율 표시 + 통화 선택 |
| 좌측 | ProductSearchInput | HS Code/제품명 검색 |
| 좌측 | ProductInfoInput | 원가, 수량 입력 |
| 좌측 | DimensionsInput | 제품 크기 입력 (가로x높이x폭) |
| 좌측 | ShippingCompanySelector | 국제 운송 업체 선택 |
| 좌측 | AdditionalCostInput | 부대 비용 (직접 입력) |
| 좌측 | CompanyCostSelector | 업체별 공통 비용 체크박스 |
| 좌측 | OrderCountInput | 주문 건수 입력 |
| 우측 상단 | CBMDisplay | CBM 계산 결과 |
| 우측 | CostBreakdown | 비용 항목별 상세 |
| 우측 | TotalCostCard | 총 수입원가 강조 표시 |
| 우측 하단 | ComparisonCard | 기본 vs FTA 비교 |

### 5.3 반응형 대응
- **lg (1024px+)**: 좌우 50:50 분할
- **md 이하**: 세로 스택 (입력 → 결과)

---

## 6. 데이터 모델 (Convex)

### 6.1 스키마

```typescript
// convex/schema.ts

// 국제 운송 업체
shippingCompanies: {
  name: string              // 업체명
  description?: string      // 설명
  isActive: boolean         // 활성화 여부
  createdAt: number
  updatedAt: number
}

// CBM 구간별 국제 운송료 (업체별)
internationalShippingRates: {
  companyId: Id<"shippingCompanies">  // 업체 ID
  minCbm: number                       // 최소 CBM
  maxCbm: number                       // 최대 CBM
  ratePerCbm: number                   // CBM당 단가
  fixedRate?: number                   // 고정 요금 (선택)
  createdAt: number
  updatedAt: number
}

// 업체별 공통 비용 항목 (통관 건당)
companyCostItems: {
  companyId: Id<"shippingCompanies">  // 업체 ID
  name: string                         // 비용 항목명 (통관수수료, D/O비용 등)
  description?: string                 // 설명
  defaultAmount: number                // 기본 금액
  isDivisible: boolean                 // 주문 건수 분할 가능 여부
  isRequired: boolean                  // 필수 여부
  sortOrder: number                    // 정렬 순서
  createdAt: number
  updatedAt: number
}

// 부대 비용 항목 정의
additionalCostItems: {
  name: string                         // 항목명 (중국 내륙 운송료 등)
  description?: string                 // 설명
  isManualInput: boolean               // 직접 입력 여부
  defaultAmount?: number               // 기본 금액 (선택)
  sortOrder: number
  createdAt: number
  updatedAt: number
}
```

### 6.2 기본 데이터

**국제 운송 업체**
```json
{ "name": "기본 업체", "isActive": true }
```

**CBM 구간 (기본 업체)**
```json
[
  { "minCbm": 0, "maxCbm": 0.5, "fixedRate": 50000 },
  { "minCbm": 0.5, "maxCbm": 1, "ratePerCbm": 100000 },
  { "minCbm": 1, "maxCbm": 2, "ratePerCbm": 90000 },
  { "minCbm": 2, "maxCbm": 5, "ratePerCbm": 80000 },
  { "minCbm": 5, "maxCbm": 999, "ratePerCbm": 70000 }
]
```

**업체별 공통 비용 (기본 업체)**
```json
[
  { "name": "통관수수료", "defaultAmount": 22000, "isDivisible": true },
  { "name": "D/O 비용", "defaultAmount": 35000, "isDivisible": true },
  { "name": "C/O 비용", "defaultAmount": 25000, "isDivisible": true }
]
```

**부대 비용 항목**
```json
[
  { "name": "중국 내륙 운송료", "isManualInput": true, "defaultAmount": 0 }
]
```

---

## 7. 파일 구조

### 7.1 신규 생성

```
src/
├── components/calculator/
│   ├── ImportCalculator.tsx       # 메인 컨테이너
│   ├── input/
│   │   ├── CurrencySelector.tsx
│   │   ├── ProductSearchInput.tsx
│   │   ├── ProductInfoInput.tsx
│   │   ├── DimensionsInput.tsx
│   │   ├── ShippingCompanySelector.tsx
│   │   ├── AdditionalCostInput.tsx    # 부대 비용 직접 입력
│   │   ├── CompanyCostSelector.tsx    # 업체별 공통 비용
│   │   └── OrderCountInput.tsx
│   ├── result/
│   │   ├── CBMDisplay.tsx
│   │   ├── CostBreakdown.tsx
│   │   ├── TotalCostCard.tsx
│   │   └── ComparisonCard.tsx
│   └── admin/
│       ├── ShippingCompanyManager.tsx  # 업체 관리
│       ├── ShippingRateEditor.tsx      # CBM 구간 설정
│       ├── CompanyCostEditor.tsx       # 업체별 공통 비용 설정
│       └── AdditionalCostEditor.tsx    # 부대 비용 항목 설정
├── hooks/
│   ├── useCalculation.ts
│   ├── useShippingCompanies.ts
│   ├── useShippingRates.ts
│   ├── useCompanyCosts.ts
│   └── useAdditionalCosts.ts
├── lib/calculations/
│   ├── cbm.ts
│   ├── shipping.ts
│   ├── costs.ts
│   └── index.ts
├── types/
│   └── shipping.ts
└── app/
    ├── ConvexClientProvider.tsx
    └── settings/page.tsx          # 관리자 설정 페이지

convex/
├── schema.ts
├── shippingCompanies.ts
├── shippingRates.ts
├── companyCosts.ts
└── additionalCosts.ts
```

### 7.2 수정 파일

- `src/app/layout.tsx` - Convex Provider 추가
- `src/app/page.tsx` - 새 ImportCalculator 사용

---

## 8. 검증 계획

### 8.1 기능 테스트

- [ ] CBM 자동 계산 (크기 x 수량)
- [ ] 국제 운송료 구간별 계산
- [ ] 국내 운송료 자동 계산
- [ ] 송금 수수료 (100만원 기준 분기)
- [ ] **부대 비용 직접 입력**
- [ ] **업체별 공통 비용 주문 건수 분할**
- [ ] 업체 CRUD 동작
- [ ] 운송료 구간 CRUD 동작
- [ ] 공통 비용 CRUD 동작
- [ ] 부대 비용 항목 CRUD 동작

### 8.2 UI 테스트

- [ ] 좌우 분할 레이아웃 (데스크톱)
- [ ] 세로 스택 레이아웃 (모바일)
- [ ] 실시간 계산 결과 반영
- [ ] 입력값 포맷팅 (천 단위 콤마)
- [ ] 직접 입력 필드 동작

### 8.3 계산 검증

- [ ] 수동 계산 결과와 비교
- [ ] 경계값 테스트 (0.5CBM, 1CBM, 100만원 등)
- [ ] 주문 건수 분할 계산 검증

---

## 9. 제약 사항 및 향후 계획

### 9.1 현재 미포함 (추후 제공 예정)

- HS Code 데이터 (제품명/카테고리 연동)
- 중국 내륙 운송료 자동 계산 로직
- 할당관세, 특수관세

### 9.2 향후 확장

- 중국 내륙 운송료 로직 추가
- 다중 통화 지원 확대
- 견적서 PDF 출력
- 히스토리 저장

---

## 10. 참고 자료

### 10.1 관련 문서
- unified-calculator.md (기존 통합 계산기 PRD)
- exchange-calculator.md (환율 계산기 PRD)

### 10.2 기술 스택
- **프레임워크**: Next.js + TypeScript
- **스타일링**: Tailwind CSS + shadcn/ui
- **상태관리**: Zustand
- **데이터베이스**: Convex
- **환율 API**: 한국수출입은행 API
